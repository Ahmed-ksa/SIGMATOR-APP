<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIGMATOR - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --radius: 16px;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        input, button, textarea, select {
            font-family: inherit;
        }

        /* Editable Text Styles */
        .editable-text {
            position: relative;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 6px;
            transition: all 0.2s;
            display: inline-block;
        }

        .editable-text:hover {
            background: rgba(37, 99, 235, 0.1);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .edit-icon {
            position: absolute;
            top: -10px;
            left: -10px;
            font-size: 14px;
            background: var(--primary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: var(--shadow);
        }

        .editable-text:hover .edit-icon {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 24px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Login Page */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .login-box {
            background: white;
            border-radius: 24px;
            padding: 48px;
            width: 100%;
            max-width: 460px;
            box-shadow: var(--shadow-xl);
        }

        .login-logo {
            width: 72px;
            height: 72px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 32px;
            font-size: 36px;
        }

        .login-title {
            font-size: 32px;
            font-weight: 900;
            text-align: center;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-subtitle {
            text-align: center;
            color: var(--gray-500);
            font-size: 16px;
            margin-bottom: 40px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 8px;
            color: var(--gray-700);
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Dashboard */
        .dashboard {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            padding: 20px 32px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 24px;
            flex-wrap: wrap;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .header-title {
            font-size: 20px;
            font-weight: 800;
            color: var(--gray-900);
        }

        .header-user {
            font-size: 14px;
            color: var(--gray-500);
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn-header {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            background: var(--danger);
            color: white;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-header:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .main-content {
            flex: 1;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
            padding: 32px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 900;
            color: var(--gray-900);
        }

        /* Quick Access Cards */
        .quick-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .quick-card {
            background: white;
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s;
            border-top: 4px solid;
        }

        .quick-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .quick-card.primary {
            border-top-color: var(--primary);
        }

        .quick-card.success {
            border-top-color: var(--success);
        }

        .quick-card.warning {
            border-top-color: var(--warning);
        }

        .quick-card.secondary {
            border-top-color: var(--secondary);
        }

        .quick-card-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .quick-card-title {
            font-size: 16px;
            font-weight: 800;
            color: var(--gray-900);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 28px;
            box-shadow: var(--shadow);
            border-top: 4px solid;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card.success {
            border-top-color: var(--success);
        }

        .stat-card.warning {
            border-top-color: var(--warning);
        }

        .stat-card.primary {
            border-top-color: var(--primary);
        }

        .stat-card.danger {
            border-top-color: var(--danger);
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray-500);
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-value {
            font-size: 40px;
            font-weight: 900;
            margin-bottom: 8px;
        }

        .stat-value.success {
            color: var(--success);
        }

        .stat-value.warning {
            color: var(--warning);
        }

        .stat-value.primary {
            color: var(--primary);
        }

        .stat-value.danger {
            color: var(--danger);
        }

        .stat-detail {
            font-size: 13px;
            color: var(--gray-400);
        }

        /* Card */
        .card {
            background: white;
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        /* Table */
        .table-container {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table thead {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .table th {
            padding: 18px 16px;
            text-align: right;
            color: white;
            font-weight: 800;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table td {
            padding: 16px;
            border-bottom: 1px solid var(--gray-100);
        }

        .table tbody tr {
            transition: background 0.2s;
        }

        .table tbody tr:hover {
            background: var(--gray-50);
        }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge.success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge.warning {
            background: #fef3c7;
            color: #92400e;
        }

        /* Buttons */
        .btn-sm {
            padding: 10px 18px;
            font-size: 14px;
            border-radius: 8px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-edit {
            background: var(--primary);
            color: white;
        }

        .btn-edit:hover {
            background: var(--primary-dark);
        }

        .btn-delete {
            background: var(--danger);
            color: white;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 24px;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: white;
            border-radius: 24px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-100);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 900;
            color: var(--gray-900);
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: none;
            background: var(--gray-100);
            color: var(--gray-600);
            font-size: 20px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--gray-200);
            transform: rotate(90deg);
        }

        .form-row {
            display: grid;
            gap: 16px;
            margin-bottom: 20px;
        }

        .form-row.cols-2 {
            grid-template-columns: 1fr 1fr;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 2px solid var(--gray-100);
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }

        .filter-btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: 2px solid var(--gray-200);
            background: white;
            color: var(--gray-600);
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            border-color: var(--gray-300);
            background: var(--gray-50);
        }

        .filter-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 15px;
            background: white url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%2394a3b8" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>') no-repeat 14px center;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 24px;
            color: var(--gray-400);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--gray-600);
        }

        .empty-text {
            font-size: 14px;
            color: var(--gray-400);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 24px;
            background: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
            animation: slideInLeft 0.3s;
            z-index: 2000;
        }

        @keyframes slideInLeft {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast-icon {
            font-size: 24px;
        }

        .toast-message {
            flex: 1;
            font-weight: 700;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .header {
                padding: 16px 20px;
            }

            .login-box {
                padding: 32px 24px;
            }

            .modal {
                padding: 24px;
            }

            .form-row.cols-2 {
                grid-template-columns: 1fr;
            }

            .page-title {
                font-size: 24px;
            }

            .stat-value {
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading-screen">
            <div class="loading-content">
                <div class="spinner"></div>
                <div style="font-size: 18px; font-weight: 700;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        setTimeout(initApp, 1000);

        function initApp() {
            if (typeof firebase === 'undefined') {
                showToast('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Firebase', 'error');
                return;
            }

            const config = {
                apiKey: "AIzaSyA3jj5vLbx8eoLNy7YAltlGDt4a6LwqukQ",
                authDomain: "login-system-848da.firebaseapp.com",
                databaseURL: "https://login-system-848da-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "login-system-848da",
                storageBucket: "login-system-848da.firebasestorage.app",
                messagingSenderId: "357774575981",
                appId: "1:357774575981:web:63ae6c73e99cf86becb264"
            };

            firebase.initializeApp(config);
            const db = firebase.database();

            let state = {
                isAuth: false,
                currentAdmin: '',
                admins: {},
                users: {},
                settings: {},
                appVersion: {},
                revenueSettings: {},
                cmsContent: {},
                customPages: {},
                editMode: false,
                view: 'dashboard',
                selectedUser: null,
                filter: 'all',
                search: '',
                loading: false,
                lastActivity: Date.now()
            };

            // Session timeout checker (10 minutes = 600000 ms)
            const SESSION_TIMEOUT = 600000; // 10 minutes
            
            function checkSession() {
                if (state.isAuth) {
                    const now = Date.now();
                    if (now - state.lastActivity > SESSION_TIMEOUT) {
                        showToast('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø·', 'error');
                        state.isAuth = false;
                        state.currentAdmin = '';
                        render();
                    }
                }
            }

            function updateActivity() {
                state.lastActivity = Date.now();
            }

            // Check session every minute
            setInterval(checkSession, 60000);
            
            // Update activity on any interaction
            document.addEventListener('click', updateActivity);
            document.addEventListener('keypress', updateActivity);
            document.addEventListener('scroll', updateActivity);

            // Utility: Show toast notification
            function showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div class="toast-icon">${type === 'success' ? 'âœ…' : 'âŒ'}</div>
                    <div class="toast-message">${message}</div>
                `;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }

            // Utility: Show confirm modal
            function showConfirm(title, message, onConfirm) {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal" style="max-width: 450px;">
                        <div class="modal-header">
                            <h2 class="modal-title">âš ï¸ ${title}</h2>
                            <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">âœ•</button>
                        </div>
                        <p style="font-size: 16px; color: var(--gray-700); line-height: 1.8; margin-bottom: 24px;">${message}</p>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-danger" style="flex: 1;" onclick="this.closest('.modal-overlay').confirmAction()">
                                <span>âœ“</span>
                                <span>ØªØ£ÙƒÙŠØ¯</span>
                            </button>
                            <button class="btn" style="flex: 1; background: var(--gray-200); color: var(--gray-700);" onclick="this.closest('.modal-overlay').remove()">
                                <span>âœ•</span>
                                <span>Ø¥Ù„ØºØ§Ø¡</span>
                            </button>
                        </div>
                    </div>
                `;
                modal.confirmAction = () => {
                    onConfirm();
                    modal.remove();
                };
                modal.onclick = (e) => {
                    if (e.target === modal) modal.remove();
                };
                document.body.appendChild(modal);
            }

            // Utility: Show prompt modal
            function showPrompt(title, label, defaultValue, onSubmit) {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal" style="max-width: 500px;">
                        <div class="modal-header">
                            <h2 class="modal-title">${title}</h2>
                            <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">âœ•</button>
                        </div>
                        <form id="promptForm">
                            <div class="form-group">
                                <label class="form-label">${label}</label>
                                <input type="text" class="form-input" name="value" value="${defaultValue || ''}" required autofocus>
                            </div>
                            <div style="display: flex; gap: 12px; margin-top: 24px;">
                                <button type="submit" class="btn btn-primary" style="flex: 1;">
                                    <span>âœ“</span>
                                    <span>Ø­ÙØ¸</span>
                                </button>
                                <button type="button" class="btn" style="flex: 1; background: var(--gray-200); color: var(--gray-700);" onclick="this.closest('.modal-overlay').remove()">
                                    <span>âœ•</span>
                                    <span>Ø¥Ù„ØºØ§Ø¡</span>
                                </button>
                            </div>
                        </form>
                    </div>
                `;
                modal.querySelector('#promptForm').onsubmit = (e) => {
                    e.preventDefault();
                    const value = new FormData(e.target).get('value');
                    if (value) {
                        onSubmit(value);
                        modal.remove();
                    }
                };
                modal.onclick = (e) => {
                    if (e.target === modal) modal.remove();
                };
                document.body.appendChild(modal);
            }

            // Default CMS Content
            function getDefaultContent() {
                return {
                    dashboard: {
                        title: "Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",
                        quick_users: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",
                        quick_revenue: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",
                        quick_settings: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
                        quick_notifications: "Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",
                        quick_cms: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ØµÙˆØµ",
                        quick_pages: "Ù…Ù†Ø´Ø¦ Ø§Ù„ØµÙØ­Ø§Øª"
                    },
                    stats: {
                        active_users: "Ø§Ù„Ù…Ø´ØªØ±ÙƒÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ†",
                        from_total: "Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ",
                        subscriber: "Ù…Ø´ØªØ±Ùƒ",
                        monthly_revenue: "Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",
                        paid_subscriber: "Ù…Ø´ØªØ±Ùƒ Ù…Ø¯ÙÙˆØ¹",
                        profit: "Ø§Ù„Ø±Ø¨Ø­",
                        loss: "Ø§Ù„Ø®Ø³Ø§Ø±Ø©",
                        net_pnl: "ØµØ§ÙÙŠ P&L",
                        profit_minus_loss: "Ø±Ø¨Ø­ - Ø®Ø³Ø§Ø±Ø©",
                        from_all_subscribers: "Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†"
                    },
                    users: {
                        title: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",
                        add_button: "Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…",
                        search: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…...",
                        filter_all: "Ø§Ù„ÙƒÙ„",
                        filter_active: "Ù†Ø´Ø·",
                        filter_inactive: "Ù…Ù†ØªÙ‡ÙŠ",
                        table_id: "Ø§Ù„Ù…Ø¹Ø±Ù",
                        table_user: "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
                        table_status: "Ø§Ù„Ø­Ø§Ù„Ø©",
                        table_expiry: "Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡",
                        table_profit: "Ø±Ø¨Ø­",
                        table_loss: "Ø®Ø³Ø§Ø±Ø©",
                        table_net: "ØµØ§ÙÙŠ",
                        table_actions: "Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª",
                        btn_edit: "ØªØ¹Ø¯ÙŠÙ„",
                        btn_unlink: "Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø¨Ø·",
                        status_active: "Ù†Ø´Ø·",
                        status_inactive: "Ù…Ù†ØªÙ‡ÙŠ"
                    },
                    revenue: {
                        title: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",
                        monthly_price: "Ø³Ø¹Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ",
                        currency: "Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ",
                        paid_users: "Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù…Ø¯ÙÙˆØ¹ÙŠÙ†",
                        monthly_revenue: "Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",
                        free_accounts: "Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©",
                        add_free: "Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ù…Ø¬Ø§Ù†ÙŠ",
                        remove: "Ø¥Ø²Ø§Ù„Ø©"
                    },
                    notifications: {
                        title: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",
                        add_button: "Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø±",
                        active: "Ù…ÙØ¹Ù‘Ù„",
                        inactive: "Ù…Ø¹Ø·Ù‘Ù„",
                        enable: "ØªÙØ¹ÙŠÙ„",
                        disable: "ØªØ¹Ø·ÙŠÙ„",
                        edit: "ØªØ¹Ø¯ÙŠÙ„",
                        delete: "Ø­Ø°Ù"
                    },
                    settings: {
                        title: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©",
                        cms_title: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ",
                        edit_mode: "ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±",
                        edit_hint: "Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø£ÙŠ Ù†Øµ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø¨Ø§Ø´Ø±Ø©"
                    }
                };
            }

            // Get text from CMS content with edit mode support
            function t(path, defaultText = '') {
                const keys = path.split('.');
                let value = state.cmsContent;
                
                for (const key of keys) {
                    value = value?.[key];
                    if (value === undefined) {
                        value = defaultText;
                        break;
                    }
                }
                
                const finalValue = value || defaultText;
                
                // If edit mode is on, make text editable
                if (state.editMode && state.isAuth) {
                    return `<span class="editable-text" data-cms-path="${path}" onclick="app.editText('${path}', this.innerText.trim())">
                        ${finalValue}
                        <span class="edit-icon">âœï¸</span>
                    </span>`;
                }
                
                return finalValue;
            }

            // Utility: Get current month key
            function getCurrentMonthKey() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                return `${year}_${month}`;
            }

            // Utility: Get next user ID
            function getNextUserId() {
                const userIds = Object.keys(state.users)
                    .filter(key => key.startsWith('user_'))
                    .map(key => parseInt(key.split('_')[1]))
                    .filter(num => !isNaN(num));
                
                if (userIds.length === 0) return 'user_001';
                
                const maxId = Math.max(...userIds);
                const nextId = maxId + 1;
                return 'user_' + String(nextId).padStart(3, '0');
            }

            // Login
            async function login(username, password) {
                if (!username || !password) {
                    showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    return false;
                }

                state.loading = true;
                render();

                try {
                    const snap = await db.ref('admins/' + username).once('value');
                    if (snap.exists() && snap.val().password === password) {
                        state.isAuth = true;
                        state.currentAdmin = username;
                        state.loading = false;
                        setupListeners();
                        render();
                        showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        return true;
                    }
                    showToast('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                    state.loading = false;
                    render();
                    return false;
                } catch (e) {
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message, 'error');
                    state.loading = false;
                    render();
                    return false;
                }
            }

            // Setup Firebase listeners
            function setupListeners() {
                db.ref('admins').on('value', s => {
                    state.admins = s.val() || {};
                    render();
                });
                
                db.ref('users').on('value', s => {
                    state.users = s.val() || {};
                    render();
                });
                
                db.ref('settings').on('value', s => {
                    const settings = s.val() || {};
                    state.settings = settings;
                    
                    // Extract revenue settings with safe defaults
                    state.revenueSettings = {
                        subscription_price: settings.subscription_price || 10,
                        excluded_users: Array.isArray(settings.excluded_users) ? settings.excluded_users : []
                    };
                    
                    console.log('Settings loaded:', settings);
                    console.log('Notifications:', settings.notifications);
                    console.log('Revenue settings:', state.revenueSettings);
                    
                    render();
                });
                
                db.ref('app_version').on('value', s => {
                    state.appVersion = s.val() || {};
                    render();
                });
                
                // CMS Listeners
                db.ref('cms/content').on('value', s => {
                    state.cmsContent = s.val() || getDefaultContent();
                    console.log('CMS Content loaded:', state.cmsContent);
                    render();
                });
                
                db.ref('cms/pages').on('value', s => {
                    state.customPages = s.val() || {};
                    console.log('Custom pages loaded:', state.customPages);
                    render();
                });
                
                db.ref('cms/config/edit_mode').on('value', s => {
                    state.editMode = s.val() || false;
                    console.log('Edit mode:', state.editMode);
                    render();
                });
            }

            // Calculate statistics
            function getStats() {
                const users = Object.entries(state.users);
                const now = new Date();
                const currentMonth = getCurrentMonthKey();
                const subscriptionPrice = state.revenueSettings.subscription_price || 10;
                const excludedUsers = state.revenueSettings.excluded_users || [];
                
                // Active users (excluding free accounts)
                const activeUsers = users.filter(([id, u]) => {
                    const isActive = new Date(u.subscription_end) > now;
                    const isNotExcluded = !excludedUsers.includes(id);
                    return isActive && isNotExcluded;
                });
                
                const totalActive = users.filter(([id, u]) => new Date(u.subscription_end) > now).length;
                const total = users.length;
                
                // Calculate revenue (only from non-excluded active users)
                const thisMonthRevenue = activeUsers.length * subscriptionPrice;
                
                // Calculate P&L for current month only
                let profit = 0, loss = 0;
                users.forEach(([_, u]) => {
                    if (u.stats && u.stats[currentMonth]) {
                        profit += u.stats[currentMonth].total_profit || 0;
                        loss += Math.abs(u.stats[currentMonth].total_loss || 0);
                    }
                });
                
                return {
                    active: totalActive,
                    total,
                    inactive: total - totalActive,
                    revenue: thisMonthRevenue,
                    paidUsers: activeUsers.length,
                    freeUsers: totalActive - activeUsers.length,
                    profit,
                    loss,
                    net: profit - loss,
                    currentMonth
                };
            }

            // Filter users
            function getFilteredUsers() {
                let users = Object.entries(state.users);
                
                if (state.search) {
                    const search = state.search.toLowerCase();
                    users = users.filter(([_, u]) => 
                        u.username?.toLowerCase().includes(search) ||
                        u.mac_address?.toLowerCase().includes(search)
                    );
                }
                
                const now = new Date();
                if (state.filter === 'active') {
                    users = users.filter(([_, u]) => new Date(u.subscription_end) > now);
                } else if (state.filter === 'inactive') {
                    users = users.filter(([_, u]) => new Date(u.subscription_end) <= now);
                }
                
                return users;
            }

            // Get user stats for current month
            function getUserStats(user) {
                const currentMonth = getCurrentMonthKey();
                if (user.stats && user.stats[currentMonth]) {
                    const s = user.stats[currentMonth];
                    return {
                        profit: s.total_profit || 0,
                        loss: Math.abs(s.total_loss || 0),
                        net: (s.total_profit || 0) - Math.abs(s.total_loss || 0),
                        wins: s.wins_count || 0,
                        losses: s.losses_count || 0
                    };
                }
                return { profit: 0, loss: 0, net: 0, wins: 0, losses: 0 };
            }

            // Add user
            async function showAddUserModal() {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h2>
                            <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">âœ•</button>
                        </div>
                        <form id="addUserForm">
                            <div class="form-row cols-2">
                                <div class="form-group">
                                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… *</label>
                                    <input type="text" name="username" class="form-input" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                                    <input type="text" name="password" class="form-input" required placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† MAC (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                <input type="text" name="mac" class="form-input" placeholder="xx:xx:xx:xx:xx:xx">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telegram Chat ID (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                <input type="text" name="telegram" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Chat ID">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ *</label>
                                <input type="date" name="subscription_end" class="form-input" required>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-success" style="flex: 1;">
                                    <span>ğŸ’¾</span>
                                    <span>Ø­ÙØ¸</span>
                                </button>
                                <button type="button" class="btn btn-delete" style="flex: 1;" onclick="this.closest('.modal-overlay').remove()">
                                    <span>âœ•</span>
                                    <span>Ø¥Ù„ØºØ§Ø¡</span>
                                </button>
                            </div>
                        </form>
                    </div>
                `;

                document.body.appendChild(modal);

                modal.querySelector('#addUserForm').onsubmit = async (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const data = {
                        username: formData.get('username'),
                        password: formData.get('password'),
                        mac_address: formData.get('mac') || '',
                        telegram_chat_id: formData.get('telegram') || null,
                        subscription_end: formData.get('subscription_end'),
                        bot_status: 'pending',
                        bot_link_status: 'pending_start',
                        last_login_date: new Date().toISOString().split('T')[0],
                        stats: {}
                    };

                    const userId = getNextUserId();
                    
                    try {
                        await db.ref('users/' + userId).set(data);
                        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        modal.remove();
                    } catch (e) {
                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ' + e.message, 'error');
                    }
                };

                modal.onclick = (e) => {
                    if (e.target === modal) modal.remove();
                };
            }

            // Edit user
            async function showEditUserModal(userId) {
                const user = state.users[userId];
                if (!user) return;

                const userStats = getUserStats(user);

                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2>
                            <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">âœ•</button>
                        </div>
                        
                        <!-- User Stats -->
                        <div style="background: var(--gray-50); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                            <h4 style="font-weight: 800; margin-bottom: 16px; color: var(--gray-900);">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</h4>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; font-weight: 900; color: var(--success);">$${userStats.profit.toFixed(2)}</div>
                                    <div style="font-size: 12px; color: var(--gray-500);">Ø±Ø¨Ø­</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; font-weight: 900; color: var(--danger);">$${userStats.loss.toFixed(2)}</div>
                                    <div style="font-size: 12px; color: var(--gray-500);">Ø®Ø³Ø§Ø±Ø©</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; font-weight: 900; color: ${userStats.net >= 0 ? 'var(--success)' : 'var(--danger)'};">$${userStats.net.toFixed(2)}</div>
                                    <div style="font-size: 12px; color: var(--gray-500);">ØµØ§ÙÙŠ</div>
                                </div>
                            </div>
                        </div>

                        <form id="editUserForm">
                            <div class="form-row cols-2">
                                <div class="form-group">
                                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                                    <input type="text" name="username" class="form-input" value="${user.username || ''}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                    <input type="text" name="password" class="form-input" value="${user.password || ''}" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† MAC</label>
                                <input type="text" name="mac" class="form-input" value="${user.mac_address || ''}" placeholder="xx:xx:xx:xx:xx:xx">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telegram Chat ID</label>
                                <input type="text" name="telegram" class="form-input" value="${user.telegram_chat_id || ''}" placeholder="Ø£Ø¯Ø®Ù„ Chat ID">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
                                <input type="date" name="subscription_end" class="form-input" value="${user.subscription_end || ''}" required>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-success" style="flex: 1;">
                                    <span>ğŸ’¾</span>
                                    <span>Ø­ÙØ¸</span>
                                </button>
                                <button type="button" class="btn btn-delete" style="flex: 1;" onclick="app.deleteUser('${userId}')">
                                    <span>ğŸ—‘ï¸</span>
                                    <span>Ø­Ø°Ù</span>
                                </button>
                            </div>
                        </form>
                    </div>
                `;

                document.body.appendChild(modal);

                modal.querySelector('#editUserForm').onsubmit = async (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const updates = {
                        username: formData.get('username'),
                        password: formData.get('password'),
                        mac_address: formData.get('mac') || '',
                        telegram_chat_id: formData.get('telegram') || null,
                        subscription_end: formData.get('subscription_end')
                    };

                    try {
                        await db.ref('users/' + userId).update(updates);
                        showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        modal.remove();
                    } catch (e) {
                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«: ' + e.message, 'error');
                    }
                };

                modal.onclick = (e) => {
                    if (e.target === modal) modal.remove();
                };
            }

            // Delete user
            async function deleteUser(userId) {
                showConfirm(
                    'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù',
                    'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!',
                    async () => {
                        try {
                            await db.ref('users/' + userId).remove();
                            showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                            document.querySelector('.modal-overlay')?.remove();
                        } catch (e) {
                            showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù: ' + e.message, 'error');
                        }
                    }
                );
            }

            // Unlink device
            async function unlinkDevice(userId) {
                showConfirm(
                    'Ø¥Ù„ØºØ§Ø¡ Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ø¬Ù‡Ø§Ø²',
                    'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ø¬Ù‡Ø§Ø² Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ',
                    async () => {
                        try {
                            await db.ref('users/' + userId).update({
                                mac_address: '',
                                bot_status: 'pending',
                                bot_link_status: 'pending_start'
                            });
                            showToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        } catch (e) {
                            showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                        }
                    }
                );
            }

            // Render
            function render() {
                const root = document.getElementById('root');

                if (!state.isAuth) {
                    root.innerHTML = `
                        <div class="login-container">
                            <div class="login-box">
                                <div class="login-logo">ğŸ›¡ï¸</div>
                                <h1 class="login-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
                                <p class="login-subtitle">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… SIGMATOR</p>
                                <form id="loginForm">
                                    <div class="form-group">
                                        <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                                        <input type="text" name="username" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required autocomplete="username">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                        <input type="password" name="password" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required autocomplete="current-password">
                                    </div>
                                    <button type="submit" class="btn btn-primary" ${state.loading ? 'disabled' : ''}>
                                        <span>${state.loading ? 'â³' : 'ğŸ”'}</span>
                                        <span>${state.loading ? 'Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...' : 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„'}</span>
                                    </button>
                                </form>
                            </div>
                        </div>
                    `;

                    document.getElementById('loginForm').onsubmit = (e) => {
                        e.preventDefault();
                        const formData = new FormData(e.target);
                        login(formData.get('username'), formData.get('password'));
                    };
                } else {
                    const stats = getStats();
                    const users = getFilteredUsers();

                    root.innerHTML = `
                        <div class="dashboard">
                            <header class="header">
                                <div class="header-content">
                                    <div class="header-brand" style="cursor: pointer;" onclick="app.setView('dashboard')">
                                        <div class="header-logo">ğŸ›¡ï¸</div>
                                        <div>
                                            <div class="header-title">SIGMATOR</div>
                                            <div class="header-user">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${state.currentAdmin}</div>
                                        </div>
                                    </div>
                                    <div class="header-actions">
                                        ${state.view !== 'dashboard' ? `
                                            <button class="btn-header" style="background: var(--primary);" onclick="app.setView('dashboard')">
                                                â† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                                            </button>
                                        ` : ''}
                                        <button class="btn-header" onclick="app.logout()">
                                            ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                                        </button>
                                    </div>
                                </div>
                            </header>
                            <main class="main-content">
                                ${state.view === 'dashboard' ? renderDashboard(stats) : ''}
                                ${state.view === 'users' ? renderUsers(stats, users) : ''}
                                ${state.view === 'settings' ? renderSettings() : ''}
                                ${state.view === 'notifications' ? renderNotifications() : ''}
                                ${state.view === 'revenue' ? renderRevenue(stats) : ''}
                                ${state.view === 'admins' ? renderAdmins() : ''}
                                ${state.view === 'cms_manager' ? renderCMSManager() : ''}
                                ${state.view === 'page_builder' ? renderPageBuilder() : ''}
                                ${state.customPages[state.view] ? renderCustomPage(state.view) : ''}
                            </main>
                        </div>
                    `;

                    if (state.view === 'users') {
                        const searchInput = document.getElementById('searchInput');
                        if (searchInput) {
                            searchInput.oninput = (e) => {
                                state.search = e.target.value;
                                render();
                            };
                        }
                    }
                }
            }

            function renderDashboard(stats) {
                return `
                    <div class="page-header">
                        <h1 class="page-title">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h1>
                    </div>

                    <!-- Quick Access Cards -->
                    <div class="quick-cards">
                        <div class="quick-card primary" onclick="app.setView('users')">
                            <div class="quick-card-icon">ğŸ‘¥</div>
                            <div class="quick-card-title">${t('dashboard.quick_users', 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†')}</div>
                        </div>
                        <div class="quick-card success" onclick="app.setView('revenue')">
                            <div class="quick-card-icon">ğŸ’°</div>
                            <div class="quick-card-title">${t('dashboard.quick_revenue', 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª')}</div>
                        </div>
                        <div class="quick-card warning" onclick="app.setView('settings')">
                            <div class="quick-card-icon">âš™ï¸</div>
                            <div class="quick-card-title">${t('dashboard.quick_settings', 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª')}</div>
                        </div>
                        <div class="quick-card secondary" onclick="app.setView('notifications')">
                            <div class="quick-card-icon">ğŸ””</div>
                            <div class="quick-card-title">${t('dashboard.quick_notifications', 'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª')}</div>
                        </div>
                        <div class="quick-card" style="border-top-color: #ec4899;" onclick="app.setView('cms_manager')">
                            <div class="quick-card-icon">ğŸ“</div>
                            <div class="quick-card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ØµÙˆØµ</div>
                        </div>
                        <div class="quick-card" style="border-top-color: #8b5cf6;" onclick="app.setView('page_builder')">
                            <div class="quick-card-icon">ğŸ¨</div>
                            <div class="quick-card-title">Ù…Ù†Ø´Ø¦ Ø§Ù„ØµÙØ­Ø§Øª</div>
                        </div>
                        ${Object.entries(state.customPages).filter(([_, page]) => page.enabled).sort((a, b) => a[1].order - b[1].order).map(([id, page]) => `
                            <div class="quick-card" style="border-top-color: #06b6d4;" onclick="app.setView('${id}')">
                                <div class="quick-card-icon">${page.icon}</div>
                                <div class="quick-card-title">${page.name}</div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- Stats -->
                    <div class="stats-grid">
                        <div class="stat-card success">
                            <div class="stat-label">
                                <span>ğŸ‘¥</span>
                                <span>Ø§Ù„Ù…Ø´ØªØ±ÙƒÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</span>
                            </div>
                            <div class="stat-value success">${stats.active}</div>
                            <div class="stat-detail">Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${stats.total} Ù…Ø´ØªØ±Ùƒ</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-label">
                                <span>ğŸ’°</span>
                                <span>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</span>
                            </div>
                            <div class="stat-value warning">$${stats.revenue.toFixed(2)}</div>
                            <div class="stat-detail">${stats.paidUsers} Ù…Ø´ØªØ±Ùƒ Ù…Ø¯ÙÙˆØ¹</div>
                        </div>
                        <div class="stat-card ${stats.net >= 0 ? 'success' : 'danger'}">
                            <div class="stat-label">
                                <span>ğŸ“ˆ</span>
                                <span>Ø§Ù„Ø±Ø¨Ø­ (${stats.currentMonth})</span>
                            </div>
                            <div class="stat-value success">$${stats.profit.toFixed(2)}</div>
                            <div class="stat-detail">Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</div>
                        </div>
                        <div class="stat-card ${stats.net >= 0 ? 'success' : 'danger'}">
                            <div class="stat-label">
                                <span>ğŸ“‰</span>
                                <span>Ø§Ù„Ø®Ø³Ø§Ø±Ø© (${stats.currentMonth})</span>
                            </div>
                            <div class="stat-value danger">$${stats.loss.toFixed(2)}</div>
                            <div class="stat-detail">Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</div>
                        </div>
                        <div class="stat-card primary">
                            <div class="stat-label">
                                <span>ğŸ’¹</span>
                                <span>ØµØ§ÙÙŠ P&L (${stats.currentMonth})</span>
                            </div>
                            <div class="stat-value ${stats.net >= 0 ? 'success' : 'danger'}">$${stats.net.toFixed(2)}</div>
                            <div class="stat-detail">Ø±Ø¨Ø­ - Ø®Ø³Ø§Ø±Ø©</div>
                        </div>
                    </div>
                `;
            }

            function renderUsers(stats, users) {
                const currentMonth = getCurrentMonthKey();
                return `
                    <div class="page-header">
                        <h1 class="page-title">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h1>
                        <button class="btn btn-success" onclick="app.addUser()">
                            <span>â•</span>
                            <span>Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</span>
                        </button>
                    </div>
                    <div class="card">
                        <div class="search-box" style="margin-bottom: 20px;">
                            <input type="text" id="searchInput" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…..." value="${state.search}">
                        </div>
                        <div class="filters">
                            <button class="filter-btn ${state.filter === 'all' ? 'active' : ''}" onclick="app.setFilter('all')">
                                Ø§Ù„ÙƒÙ„ (${stats.total})
                            </button>
                            <button class="filter-btn ${state.filter === 'active' ? 'active' : ''}" onclick="app.setFilter('active')">
                                Ù†Ø´Ø· (${stats.active})
                            </button>
                            <button class="filter-btn ${state.filter === 'inactive' ? 'active' : ''}" onclick="app.setFilter('inactive')">
                                Ù…Ù†ØªÙ‡ÙŠ (${stats.inactive})
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ø¹Ø±Ù</th>
                                    <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                                    <th>Ø±Ø¨Ø­ (${currentMonth})</th>
                                    <th>Ø®Ø³Ø§Ø±Ø© (${currentMonth})</th>
                                    <th>ØµØ§ÙÙŠ</th>
                                    <th style="text-align: center;">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${users.length > 0 ? users.map(([id, u]) => {
                                    const isActive = new Date(u.subscription_end) > new Date();
                                    const userStats = getUserStats(u);
                                    return `
                                        <tr>
                                            <td style="font-family: monospace; font-weight: 700; color: var(--gray-500); font-size: 13px;">${id}</td>
                                            <td style="font-weight: 700; color: var(--gray-900);">${u.username || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                            <td>
                                                <span class="badge ${isActive ? 'success' : 'danger'}">
                                                    ${isActive ? 'âœ“ Ù†Ø´Ø·' : 'âœ— Ù…Ù†ØªÙ‡ÙŠ'}
                                                </span>
                                            </td>
                                            <td style="color: var(--gray-600); font-family: monospace; font-size: 14px;">${u.subscription_end || '-'}</td>
                                            <td style="font-weight: 700; color: var(--success); font-family: monospace;">$${userStats.profit.toFixed(2)}</td>
                                            <td style="font-weight: 700; color: var(--danger); font-family: monospace;">$${userStats.loss.toFixed(2)}</td>
                                            <td style="font-weight: 800; color: ${userStats.net >= 0 ? 'var(--success)' : 'var(--danger)'}; font-family: monospace;">$${userStats.net.toFixed(2)}</td>
                                            <td style="text-align: center;">
                                                <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                                                    <button class="btn-sm btn-edit" onclick='app.editUser("${id}")'>
                                                        âœï¸ ØªØ¹Ø¯ÙŠÙ„
                                                    </button>
                                                    <button class="btn-sm btn-warning" onclick='app.unlinkDevice("${id}")'>
                                                        ğŸ”“ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø¨Ø·
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('') : `
                                    <tr>
                                        <td colspan="8">
                                            <div class="empty-state">
                                                <div class="empty-icon">ğŸ‘¥</div>
                                                <div class="empty-title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>
                                                <div class="empty-text">Ø¬Ø±Ù‘Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø¨ÙƒÙ„Ù…Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ø£Ùˆ ØºÙŠÙ‘Ø± Ø§Ù„ÙÙ„ØªØ±</div>
                                            </div>
                                        </td>
                                    </tr>
                                `}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            function renderSettings() {
                const s = state.settings;
                return `
                    <div class="page-header">
                        <h1 class="page-title">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
                    </div>
                    
                    <div class="card">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 20px; color: var(--gray-900);">
                            ğŸ¨ ØªØ®ØµÙŠØµ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                        </h3>
                        <p style="color: var(--gray-600); margin-bottom: 20px; line-height: 1.8;">
                            ÙŠÙ…ÙƒÙ†Ùƒ ØªØ®ØµÙŠØµ Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù…Ù† Ù‡Ù†Ø§. Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙˆØ³Ø¹ Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª.
                        </p>
                        <div style="background: var(--gray-50); border-radius: 12px; padding: 20px;">
                            <p style="font-size: 14px; color: var(--gray-600);">
                                ğŸ’¡ <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ÙˆÙŠÙ…ÙƒÙ† ØªÙˆØ³ÙŠØ¹Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©.
                            </p>
                        </div>
                    </div>

                    <!-- App Version Settings -->
                    <div class="card">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 20px; color: var(--gray-900); display: flex; align-items: center; gap: 12px;">
                            <span>ğŸ“±</span>
                            <span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</span>
                        </h3>
                        <div class="form-row cols-2">
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                                <input type="text" id="app-version" class="form-input" value="${state.appVersion.latest || ''}" placeholder="1.0.0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ«</label>
                                <input type="text" id="update-url" class="form-input" value="${state.appVersion.update_url || ''}" placeholder="https://...">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø¸Ø±</label>
                            <input type="text" id="block-message" class="form-input" value="${state.appVersion.block_message || ''}" placeholder="Ø±Ø³Ø§Ù„Ø© ØªØ¸Ù‡Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†">
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                                <input type="checkbox" id="force-block" ${state.appVersion.force_block_old_versions ? 'checked' : ''} style="width: 20px; height: 20px; cursor: pointer;">
                                <span class="form-label" style="margin: 0;">Ø­Ø¸Ø± Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</span>
                            </label>
                        </div>
                        <button class="btn btn-primary" onclick="app.updateAppVersion()">
                            ğŸ’¾ Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                        </button>
                    </div>

                    <!-- API Keys -->
                    <div class="card">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 20px; color: var(--gray-900); display: flex; align-items: center; gap: 12px;">
                            <span>ğŸ”‘</span>
                            <span>Ù…ÙØ§ØªÙŠØ­ API</span>
                        </h3>
                        <div class="form-group">
                            <label class="form-label">Stripe Price ID</label>
                            <div style="display: flex; gap: 12px;">
                                <input type="text" id="stripe-price-id" class="form-input" value="${s.Stripe?.PRICE_ID || ''}" placeholder="price_xxxxx" style="flex: 1;">
                                <button class="btn-sm btn-edit" onclick="app.updateSetting('settings/Stripe/PRICE_ID', document.getElementById('stripe-price-id').value)">
                                    ğŸ’¾ Ø­ÙØ¸
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ChatGPT API Key</label>
                            <div style="display: flex; gap: 12px;">
                                <input type="password" id="chatgpt-key" class="form-input" value="${s.chatGPT?.key || ''}" placeholder="sk-proj-..." style="flex: 1;">
                                <button class="btn-sm btn-edit" onclick="app.updateSetting('settings/chatGPT/key', document.getElementById('chatgpt-key').value)">
                                    ğŸ’¾ Ø­ÙØ¸
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Links -->
                    <div class="card">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 20px; color: var(--gray-900); display: flex; align-items: center; gap: 12px;">
                            <span>ğŸ”—</span>
                            <span>Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</span>
                        </h3>
                        <div class="form-group">
                            <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„</label>
                            <div style="display: flex; gap: 12px;">
                                <input type="text" id="download-link" class="form-input" value="${s.download_sigmator || ''}" placeholder="https://..." style="flex: 1;">
                                <button class="btn-sm btn-edit" onclick="app.updateSetting('settings/download_sigmator', document.getElementById('download-link').value)">
                                    ğŸ’¾ Ø­ÙØ¸
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</label>
                            <div style="display: flex; gap: 12px;">
                                <input type="text" id="public-group" class="form-input" value="${s.public_group || ''}" placeholder="https://t.me/..." style="flex: 1;">
                                <button class="btn-sm btn-edit" onclick="app.updateSetting('settings/public_group', document.getElementById('public-group').value)">
                                    ğŸ’¾ Ø­ÙØ¸
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderNotifications() {
                // Safely read notifications with multiple fallbacks
                const notifications = state.settings?.notifications || {};
                const notifEntries = Object.entries(notifications);
                
                console.log('Rendering notifications...');
                console.log('State.settings:', state.settings);
                console.log('Notifications object:', notifications);
                console.log('Notification entries:', notifEntries);
                
                return `
                    <div class="page-header">
                        <h1 class="page-title">ğŸ”” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ${notifEntries.length > 0 ? `(${notifEntries.length})` : ''}</h1>
                        <button class="btn btn-success" onclick="app.addNotification()">
                            <span>â•</span>
                            <span>Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø±</span>
                        </button>
                    </div>
                    
                    ${notifEntries.length > 0 ? `
                        <div style="display: grid; gap: 16px;">
                            ${notifEntries.map(([key, notif]) => {
                                // Ensure notif is an object
                                if (!notif || typeof notif !== 'object') {
                                    console.warn('Invalid notification:', key, notif);
                                    return '';
                                }
                                
                                const isActive = notif.is_active === true;
                                const message = notif.message || '';
                                
                                return `
                                    <div class="card" style="border-right: 4px solid ${isActive ? 'var(--success)' : 'var(--gray-300)'};">
                                        <div style="display: flex; justify-content: space-between; align-items: start; gap: 16px; flex-wrap: wrap;">
                                            <div style="flex: 1; min-width: 200px;">
                                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                                    <span class="badge ${isActive ? 'success' : 'danger'}">
                                                        ${isActive ? 'âœ“ Ù…ÙØ¹Ù‘Ù„' : 'âœ— Ù…Ø¹Ø·Ù‘Ù„'}
                                                    </span>
                                                    <span style="font-family: monospace; font-size: 13px; color: var(--gray-500); font-weight: 700;">${key}</span>
                                                </div>
                                                <p style="font-size: 16px; font-weight: 600; color: var(--gray-900); line-height: 1.6;">
                                                    ${message}
                                                </p>
                                            </div>
                                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                                <button class="btn-sm ${isActive ? 'btn-delete' : 'btn-success'}" onclick="app.toggleNotification('${key}', ${!isActive})">
                                                    ${isActive ? 'â¸ï¸ ØªØ¹Ø·ÙŠÙ„' : 'â–¶ï¸ ØªÙØ¹ÙŠÙ„'}
                                                </button>
                                                <button class="btn-sm btn-edit" onclick="app.editNotification('${key}', \`${message.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`)">
                                                    âœï¸ ØªØ¹Ø¯ÙŠÙ„
                                                </button>
                                                <button class="btn-sm btn-delete" onclick="app.deleteNotification('${key}')">
                                                    ğŸ—‘ï¸ Ø­Ø°Ù
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).filter(html => html !== '').join('')}
                        </div>
                    ` : `
                        <div class="card">
                            <div class="empty-state">
                                <div class="empty-icon">ğŸ””</div>
                                <div class="empty-title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>
                                <div class="empty-text">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø±" Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯</div>
                            </div>
                        </div>
                    `}
                `;
            }

            function renderRevenue(stats) {
                const price = state.revenueSettings.subscription_price || 10;
                const excluded = state.revenueSettings.excluded_users || [];
                
                return `
                    <div class="page-header">
                        <h1 class="page-title">ğŸ’° Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h1>
                    </div>
                    
                    <!-- Revenue Stats -->
                    <div class="stats-grid" style="margin-bottom: 32px;">
                        <div class="stat-card warning">
                            <div class="stat-label">
                                <span>ğŸ’µ</span>
                                <span>Ø³Ø¹Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ</span>
                            </div>
                            <div class="stat-value warning">$${price.toFixed(2)}</div>
                            <div class="stat-detail">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-label">
                                <span>ğŸ‘¥</span>
                                <span>Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù…Ø¯ÙÙˆØ¹ÙŠÙ†</span>
                            </div>
                            <div class="stat-value success">${stats.paidUsers}</div>
                            <div class="stat-detail">Ù…Ù† ${stats.active} Ù†Ø´Ø·</div>
                        </div>
                        <div class="stat-card primary">
                            <div class="stat-label">
                                <span>ğŸ’°</span>
                                <span>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</span>
                            </div>
                            <div class="stat-value primary">$${stats.revenue.toFixed(2)}</div>
                            <div class="stat-detail">${stats.paidUsers} Ã— $${price}</div>
                        </div>
                    </div>

                    <!-- Subscription Price -->
                    <div class="card">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 20px; color: var(--gray-900); display: flex; align-items: center; gap: 12px;">
                            <span>ğŸ’µ</span>
                            <span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø¹Ø±</span>
                        </h3>
                        <div class="form-group">
                            <label class="form-label">Ø³Ø¹Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±)</label>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <input type="number" id="subscription-price" class="form-input" value="${price}" min="0" step="0.01" style="max-width: 200px;">
                                <button class="btn btn-primary" onclick="app.updateSubscriptionPrice()">
                                    ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø³Ø¹Ø±
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Excluded Users -->
                    <div class="card">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 20px; color: var(--gray-900); display: flex; align-items: center; gap: 12px;">
                            <span>ğŸ</span>
                            <span>Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© (${stats.freeUsers})</span>
                        </h3>
                        <p style="color: var(--gray-600); margin-bottom: 20px; line-height: 1.8;">
                            Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…Ø¯Ø±Ø¬ÙˆÙ† ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù† ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨Ù‡Ù… ÙÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
                        </p>
                        
                        ${excluded.length > 0 ? `
                            <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px;">
                                ${excluded.map(userId => {
                                    const user = state.users[userId];
                                    return `
                                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: var(--gray-50); border-radius: 12px;">
                                            <div>
                                                <div style="font-weight: 700; color: var(--gray-900); margin-bottom: 4px;">
                                                    ${user?.username || 'Unknown'}
                                                </div>
                                                <div style="font-family: monospace; font-size: 13px; color: var(--gray-500);">
                                                    ${userId}
                                                </div>
                                            </div>
                                            <button class="btn-sm btn-delete" onclick="app.removeExcludedUser('${userId}')">
                                                âœ• Ø¥Ø²Ø§Ù„Ø©
                                            </button>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : `
                            <div style="padding: 40px; text-align: center; background: var(--gray-50); border-radius: 12px; margin-bottom: 20px;">
                                <div style="font-size: 48px; margin-bottom: 12px; opacity: 0.3;">ğŸ</div>
                                <p style="color: var(--gray-500); font-size: 14px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                            </div>
                        `}
                        
                        <button class="btn btn-success" onclick="app.addExcludedUser()">
                            <span>â•</span>
                            <span>Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ù…Ø¬Ø§Ù†ÙŠ</span>
                        </button>
                    </div>
                `;
            }

            function renderCMSManager() {
                const contentEntries = Object.entries(state.cmsContent);
                
                return `
                    <div class="page-header">
                        <h1 class="page-title">ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©</h1>
                        <button class="btn ${state.editMode ? 'btn-delete' : 'btn-success'}" onclick="app.toggleEditMode()">
                            ${state.editMode ? 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±' : 'â–¶ï¸ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±'}
                        </button>
                    </div>
                    
                    <div class="card">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 20px;">
                            ğŸ¯ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±
                        </h3>
                        <p style="color: var(--gray-600); line-height: 1.8; margin-bottom: 20px;">
                            ${state.editMode 
                                ? 'âœ… <strong>ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ± Ù…ÙØ¹Ù‘Ù„!</strong> Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù†Øµ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„ØªØ¹Ø¯ÙŠÙ„Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø©.' 
                                : 'âš ï¸ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ± Ù…Ø¹Ø·Ù‘Ù„. ÙØ¹Ù‘Ù„Ù‡ Ø£Ø¹Ù„Ø§Ù‡ Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.'}
                        </p>
                        <div style="background: var(--gray-50); border-radius: 12px; padding: 20px;">
                            <p style="font-size: 14px; color: var(--gray-600); line-height: 1.8;">
                                ğŸ’¡ <strong>ÙƒÙŠÙ ÙŠØ¹Ù…Ù„:</strong><br>
                                1. ÙØ¹Ù‘Ù„ "ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±" Ø£Ø¹Ù„Ø§Ù‡<br>
                                2. Ø§Ø°Ù‡Ø¨ Ù„Ø£ÙŠ ØµÙØ­Ø© ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹<br>
                                3. Ù…Ø±Ø± Ø§Ù„Ù…Ø§ÙˆØ³ Ø¹Ù„Ù‰ Ø£ÙŠ Ù†Øµ - Ø³ØªØ¸Ù‡Ø± Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù‚Ù„Ù… âœï¸<br>
                                4. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ù„ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„<br>
                                5. Ø§Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª - Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ ÙÙˆØ±Ø§Ù‹ Ù„Ù„Ø¬Ù…ÙŠØ¹!
                            </p>
                        </div>
                    </div>

                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="font-size: 20px; font-weight: 800; margin: 0;">
                                ğŸ“‹ Ù…Ø­ØªÙˆÙ‰ CMS Ø§Ù„Ø­Ø§Ù„ÙŠ
                            </h3>
                            <button class="btn btn-primary" onclick="app.addCMSSection()">
                                â• Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯
                            </button>
                        </div>
                        
                        ${contentEntries.length > 0 ? `
                            <div style="display: grid; gap: 16px;">
                                ${contentEntries.map(([section, content]) => `
                                    <div class="card" style="background: var(--gray-50); border: 2px solid var(--gray-200);">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                            <h4 style="font-size: 18px; font-weight: 800; color: var(--primary);">
                                                ğŸ“ ${section}
                                            </h4>
                                            <div style="display: flex; gap: 8px;">
                                                <button class="btn-sm btn-edit" onclick="app.editCMSSection('${section}')">
                                                    âœï¸ ØªØ¹Ø¯ÙŠÙ„
                                                </button>
                                                <button class="btn-sm btn-delete" onclick="app.deleteCMSSection('${section}')">
                                                    ğŸ—‘ï¸ Ø­Ø°Ù
                                                </button>
                                            </div>
                                        </div>
                                        <div style="display: grid; gap: 8px; font-size: 14px;">
                                            ${Object.entries(content || {}).map(([key, value]) => `
                                                <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: white; border-radius: 8px;">
                                                    <span style="color: var(--gray-500); font-weight: 700;">${key}:</span>
                                                    <span style="color: var(--gray-900);">${value}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="empty-state">
                                <div class="empty-icon">ğŸ“</div>
                                <div class="empty-title">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ CMS</div>
                                <div class="empty-text">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù‚Ø³Ù… Ù…Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ</div>
                            </div>
                        `}
                    </div>
                `;
            }

            function renderPageBuilder() {
                const pages = Object.entries(state.customPages);
                
                return `
                    <div class="page-header">
                        <h1 class="page-title">ğŸ¨ Ù…Ù†Ø´Ø¦ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©</h1>
                        <button class="btn btn-success" onclick="app.createPage()">
                            â• Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©
                        </button>
                    </div>
                    
                    <div class="card" style="margin-bottom: 24px;">
                        <h3 style="font-size: 18px; font-weight: 800; margin-bottom: 16px;">
                            ğŸ’¡ ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ù…Ù†Ø´Ø¦ Ø§Ù„ØµÙØ­Ø§ØªØŸ
                        </h3>
                        <div style="background: var(--gray-50); border-radius: 12px; padding: 20px;">
                            <ol style="color: var(--gray-700); line-height: 2; padding-right: 20px;">
                                <li><strong>Ø£Ù†Ø´Ø¦ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©</strong> - Ø­Ø¯Ø¯ Ø§Ø³Ù… ÙˆØ£ÙŠÙ‚ÙˆÙ†Ø© Ù„Ù„ØµÙØ­Ø©</li>
                                <li><strong>Ø£Ø¶Ù Ø¹Ù†Ø§ØµØ± ØªØ­ÙƒÙ… (Widgets)</strong> - Ø­Ù‚ÙˆÙ„ Ù†ØµØŒ Ø£Ø±Ù‚Ø§Ù…ØŒ ØªÙˆØ§Ø±ÙŠØ®ØŒ Ø¥Ù„Ø®</li>
                                <li><strong>Ø§Ø±Ø¨Ø· Ù…Ø¹ Firebase</strong> - Ø­Ø¯Ø¯ Ù…Ø³Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙƒÙ„ Ø¹Ù†ØµØ±</li>
                                <li><strong>ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</strong> - Ø§Ù„ØµÙØ­Ø© ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©!</li>
                            </ol>
                        </div>
                    </div>
                    
                    ${pages.length > 0 ? `
                        <div style="display: grid; gap: 20px;">
                            ${pages.map(([id, page]) => `
                                <div class="card">
                                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 16px; flex-wrap: wrap;">
                                        <div style="display: flex; align-items: start; gap: 16px; flex: 1;">
                                            <div style="font-size: 48px; line-height: 1;">${page.icon}</div>
                                            <div style="flex: 1;">
                                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                                    <h3 style="font-size: 24px; font-weight: 900; margin: 0;">${page.name}</h3>
                                                    <span class="badge ${page.enabled ? 'success' : 'danger'}">
                                                        ${page.enabled ? 'âœ“ Ù…ÙØ¹Ù‘Ù„' : 'âœ— Ù…Ø¹Ø·Ù‘Ù„'}
                                                    </span>
                                                </div>
                                                <p style="color: var(--gray-600); font-size: 14px; margin-bottom: 12px;">
                                                    <strong>${(page.widgets || []).length}</strong> Ø¹Ù†ØµØ± ØªØ­ÙƒÙ… | 
                                                    Ø§Ù„ØªØ±ØªÙŠØ¨: <strong>${page.order}</strong>
                                                </p>
                                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                                    <button class="btn-sm btn-primary" onclick="app.setView('${id}')">
                                                        ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø©
                                                    </button>
                                                    <button class="btn-sm btn-success" onclick="app.addWidget('${id}')">
                                                        â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ±
                                                    </button>
                                                    <button class="btn-sm btn-edit" onclick="app.editPage('${id}')">
                                                        âœï¸ ØªØ¹Ø¯ÙŠÙ„
                                                    </button>
                                                    <button class="btn-sm ${page.enabled ? 'btn-warning' : 'btn-success'}" 
                                                            onclick="app.togglePage('${id}', ${!page.enabled})">
                                                        ${page.enabled ? 'â¸ï¸ ØªØ¹Ø·ÙŠÙ„' : 'â–¶ï¸ ØªÙØ¹ÙŠÙ„'}
                                                    </button>
                                                    <button class="btn-sm btn-delete" onclick="app.deletePage('${id}')">
                                                        ğŸ—‘ï¸ Ø­Ø°Ù
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="card">
                            <div class="empty-state">
                                <div class="empty-icon">ğŸ¨</div>
                                <div class="empty-title">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙØ­Ø§Øª Ù…Ø®ØµØµØ©</div>
                                <div class="empty-text">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©" Ù„Ø¨Ø¯Ø¡ Ø¨Ù†Ø§Ø¡ ØµÙØ­ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰!</div>
                            </div>
                        </div>
                    `}
                `;
            }

            function renderCustomPage(pageId) {
                const page = state.customPages[pageId];
                if (!page) return '<div class="card"><p>Ø§Ù„ØµÙØ­Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©</p></div>';
                
                return `
                    <div class="page-header">
                        <h1 class="page-title">${page.icon} ${page.name}</h1>
                        <button class="btn btn-success" onclick="app.addWidget('${pageId}')">
                            â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± ØªØ­ÙƒÙ…
                        </button>
                    </div>
                    
                    <div class="card">
                        ${(page.widgets || []).length > 0 ? `
                            <div style="display: grid; gap: 24px;">
                                ${page.widgets.map(widget => renderWidget(widget, pageId)).join('')}
                            </div>
                        ` : `
                            <div class="empty-state">
                                <div class="empty-icon">ğŸ“‹</div>
                                <div class="empty-title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ØªØ­ÙƒÙ…</div>
                                <div class="empty-text">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± ØªØ­ÙƒÙ…" Ù„Ø¨Ø¯Ø¡ Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµÙØ­Ø©</div>
                            </div>
                        `}
                    </div>
                `;
            }

            function renderWidget(widget, pageId) {
                // This will be populated with real-time data from Firebase
                const widgetId = `widget_${widget.id || widget.firebase_path.replace(/\//g, '_')}`;
                
                return `
                    <div class="card" style="background: var(--gray-50); border: 2px solid var(--gray-200);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                            <h4 style="font-size: 16px; font-weight: 800; color: var(--gray-900);">
                                ${widget.label}
                            </h4>
                            <button class="btn-sm btn-delete" onclick="app.deleteWidget('${pageId}', '${widget.id}')">
                                ğŸ—‘ï¸ Ø­Ø°Ù
                            </button>
                        </div>
                        <p style="font-size: 12px; color: var(--gray-500); margin-bottom: 12px; font-family: monospace;">
                            ğŸ“ Firebase: ${widget.firebase_path}
                        </p>
                        ${renderWidgetInput(widget, widgetId)}
                    </div>
                `;
            }

            function renderWidgetInput(widget, widgetId) {
                switch (widget.type) {
                    case 'text':
                        return `
                            <div class="form-group" style="margin: 0;">
                                <div style="display: flex; gap: 12px;">
                                    <input type="text" 
                                           class="form-input" 
                                           id="${widgetId}"
                                           placeholder="${widget.placeholder || ''}"
                                           style="flex: 1;">
                                    <button class="btn-sm btn-edit" onclick="app.saveWidgetValue('${widgetId}', '${widget.firebase_path}', 'text')">
                                        ğŸ’¾ Ø­ÙØ¸
                                    </button>
                                </div>
                            </div>
                        `;
                    
                    case 'number':
                        return `
                            <div class="form-group" style="margin: 0;">
                                <div style="display: flex; gap: 12px;">
                                    <input type="number" 
                                           class="form-input" 
                                           id="${widgetId}"
                                           min="${widget.min || ''}"
                                           max="${widget.max || ''}"
                                           step="${widget.step || 'any'}"
                                           style="flex: 1;">
                                    <button class="btn-sm btn-edit" onclick="app.saveWidgetValue('${widgetId}', '${widget.firebase_path}', 'number')">
                                        ğŸ’¾ Ø­ÙØ¸
                                    </button>
                                </div>
                            </div>
                        `;
                    
                    case 'toggle':
                        return `
                            <div class="form-group" style="margin: 0;">
                                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                                    <input type="checkbox" 
                                           id="${widgetId}"
                                           onchange="app.saveWidgetValue('${widgetId}', '${widget.firebase_path}', 'toggle')"
                                           style="width: 24px; height: 24px; cursor: pointer;">
                                    <span style="font-size: 14px; color: var(--gray-700);">ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„</span>
                                </label>
                            </div>
                        `;
                    
                    case 'date':
                        return `
                            <div class="form-group" style="margin: 0;">
                                <div style="display: flex; gap: 12px;">
                                    <input type="date" 
                                           class="form-input" 
                                           id="${widgetId}"
                                           style="flex: 1;">
                                    <button class="btn-sm btn-edit" onclick="app.saveWidgetValue('${widgetId}', '${widget.firebase_path}', 'date')">
                                        ğŸ’¾ Ø­ÙØ¸
                                    </button>
                                </div>
                            </div>
                        `;
                    
                    default:
                        return '<p style="color: var(--gray-500);">Ù†ÙˆØ¹ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</p>';
                }
            }

            function renderAdmins() {
                const admins = Object.entries(state.admins);
                return `
                    <div class="page-header">
                        <h1 class="page-title">ğŸ›¡ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</h1>
                        <button class="btn btn-success" onclick="app.addAdmin()">
                            <span>â•</span>
                            <span>Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù</span>
                        </button>
                    </div>
                    
                    <div style="display: grid; gap: 16px;">
                        ${admins.map(([username, admin]) => `
                            <div class="card">
                                <div style="display: flex; justify-content: space-between; align-items: center; gap: 16px; flex-wrap: wrap;">
                                    <div style="flex: 1; min-width: 200px;">
                                        <div style="font-size: 20px; font-weight: 800; color: var(--gray-900); margin-bottom: 8px; display: flex; align-items: center; gap: 12px;">
                                            <span>ğŸ‘¤</span>
                                            <span>${username}</span>
                                            ${username === state.currentAdmin ? '<span class="badge success">Ø£Ù†Øª</span>' : ''}
                                        </div>
                                        <div style="font-size: 14px; color: var(--gray-500);">
                                            ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: <span style="font-family: monospace; background: var(--gray-100); padding: 4px 12px; border-radius: 6px; font-weight: 700;">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                        <button class="btn-sm btn-edit" onclick="app.changeAdminPassword('${username}')">
                                            ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                                        </button>
                                        ${username !== state.currentAdmin ? `
                                            <button class="btn-sm btn-delete" onclick="app.deleteAdmin('${username}')">
                                                ğŸ—‘ï¸ Ø­Ø°Ù
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Global app object
            window.app = {
                setView: (view) => {
                    state.view = view;
                    render();
                },
                setFilter: (filter) => {
                    state.filter = filter;
                    render();
                },
                logout: () => {
                    showConfirm(
                        'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬',
                        'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ',
                        () => {
                            state.isAuth = false;
                            state.currentAdmin = '';
                            render();
                            showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        }
                    );
                },
                addUser: showAddUserModal,
                editUser: showEditUserModal,
                deleteUser: deleteUser,
                unlinkDevice: unlinkDevice,
                
                // Settings
                updateSetting: async (path, value) => {
                    if (!value) {
                        showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø©', 'error');
                        return;
                    }
                    try {
                        await db.ref(path).set(value);
                        showToast('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    } catch (e) {
                        showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                    }
                },
                
                updateAppVersion: async () => {
                    const version = document.getElementById('app-version').value;
                    const updateUrl = document.getElementById('update-url').value;
                    const blockMessage = document.getElementById('block-message').value;
                    const forceBlock = document.getElementById('force-block').checked;
                    
                    try {
                        await db.ref('app_version').set({
                            latest: version,
                            update_url: updateUrl,
                            block_message: blockMessage,
                            force_block_old_versions: forceBlock
                        });
                        showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    } catch (e) {
                        showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                    }
                },
                
                // Notifications
                addNotification: () => {
                    showPrompt('Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯', 'Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± (Ù…Ø«Ø§Ù„: m3)', '', (key) => {
                        showPrompt('Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯', 'Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±', '', async (message) => {
                            showConfirm(
                                'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±',
                                'Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¢Ù†ØŸ',
                                async () => {
                                    try {
                                        await db.ref(`settings/notifications/${key}`).set({
                                            message: message,
                                            is_active: true
                                        });
                                        showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±', 'success');
                                    } catch (e) {
                                        showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                                    }
                                }
                            );
                        });
                    });
                },
                
                editNotification: (key, oldMessage) => {
                    showPrompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±', 'Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±', oldMessage, async (newMessage) => {
                        try {
                            await db.ref(`settings/notifications/${key}/message`).set(newMessage);
                            showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        } catch (e) {
                            showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                        }
                    });
                },
                
                toggleNotification: async (key, newState) => {
                    try {
                        await db.ref(`settings/notifications/${key}/is_active`).set(newState);
                        showToast(newState ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±', 'success');
                    } catch (e) {
                        showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                    }
                },
                
                deleteNotification: (key) => {
                    showConfirm(
                        'Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±',
                        'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±ØŸ',
                        async () => {
                            try {
                                await db.ref(`settings/notifications/${key}`).remove();
                                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                            } catch (e) {
                                showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                            }
                        }
                    );
                },
                
                // Revenue
                updateSubscriptionPrice: async () => {
                    const priceInput = document.getElementById('subscription-price');
                    if (!priceInput) {
                        showToast('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¹Ø±', 'error');
                        return;
                    }
                    
                    const price = parseFloat(priceInput.value);
                    if (isNaN(price) || price < 0) {
                        showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­', 'error');
                        return;
                    }
                    
                    console.log('Updating subscription price to:', price);
                    
                    try {
                        // Update directly in settings node
                        await db.ref('settings/subscription_price').set(price);
                        showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        console.log('Price updated successfully');
                    } catch (e) {
                        console.error('Error updating price:', e);
                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«: ' + e.message, 'error');
                    }
                },
                
                addExcludedUser: () => {
                    const allUsers = Object.entries(state.users);
                    const excluded = state.revenueSettings?.excluded_users || [];
                    const available = allUsers.filter(([id]) => !excluded.includes(id));
                    
                    console.log('All users:', allUsers.length);
                    console.log('Excluded users:', excluded);
                    console.log('Available users:', available.length);
                    
                    if (available.length === 0) {
                        showToast('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø³ØªØ«Ù†ÙˆÙ† Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                        return;
                    }
                    
                    const modal = document.createElement('div');
                    modal.className = 'modal-overlay';
                    modal.innerHTML = `
                        <div class="modal">
                            <div class="modal-header">
                                <h2 class="modal-title">Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ù…Ø¬Ø§Ù†ÙŠ</h2>
                                <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">âœ•</button>
                            </div>
                            <p style="margin-bottom: 20px; color: var(--gray-600);">
                                Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØªÙ‡ ÙƒØ­Ø³Ø§Ø¨ Ù…Ø¬Ø§Ù†ÙŠ (${available.length} Ù…ØªØ§Ø­)
                            </p>
                            <div style="max-height: 400px; overflow-y: auto;">
                                ${available.map(([id, u]) => `
                                    <div style="padding: 16px; background: var(--gray-50); border-radius: 12px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; border: 2px solid transparent;" 
                                         onmouseover="this.style.borderColor='var(--primary)'; this.style.background='white';" 
                                         onmouseout="this.style.borderColor='transparent'; this.style.background='var(--gray-50)';"
                                         onclick="window.selectUserForExclusion('${id}')">
                                        <div style="font-weight: 700; color: var(--gray-900); margin-bottom: 4px;">${u.username || 'Unknown'}</div>
                                        <div style="font-family: monospace; font-size: 13px; color: var(--gray-500);">${id}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    
                    // Create global function for selection
                    window.selectUserForExclusion = async (userId) => {
                        console.log('Adding excluded user:', userId);
                        try {
                            const currentExcluded = state.revenueSettings?.excluded_users || [];
                            const newExcluded = [...currentExcluded, userId];
                            console.log('New excluded list:', newExcluded);
                            
                            await db.ref('settings/excluded_users').set(newExcluded);
                            showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©', 'success');
                            modal.remove();
                            delete window.selectUserForExclusion;
                        } catch (e) {
                            console.error('Error adding excluded user:', e);
                            showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                        }
                    };
                    
                    modal.onclick = (e) => {
                        if (e.target === modal) {
                            modal.remove();
                            delete window.selectUserForExclusion;
                        }
                    };
                    
                    document.body.appendChild(modal);
                },
                
                removeExcludedUser: (userId) => {
                    showConfirm(
                        'Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©',
                        'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø²Ø§Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©ØŸ Ø³ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨Ù‡ ÙÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©.',
                        async () => {
                            console.log('Removing excluded user:', userId);
                            try {
                                const currentExcluded = state.revenueSettings?.excluded_users || [];
                                const newExcluded = currentExcluded.filter(id => id !== userId);
                                console.log('New excluded list:', newExcluded);
                                
                                await db.ref('settings/excluded_users').set(newExcluded);
                                showToast('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©', 'success');
                            } catch (e) {
                                console.error('Error removing excluded user:', e);
                                showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                            }
                        }
                    );
                },
                
                
                // ===== CMS FUNCTIONS =====
                
                // Edit Text inline
                editText: (path, currentValue) => {
                    showPrompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Øµ', 'Ø§Ù„Ù†Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯', currentValue, async (newValue) => {
                        try {
                            const pathParts = path.split('.');
                            await db.ref(`cms/content/${pathParts.join('/')}`).set(newValue);
                            showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ Ø¨Ù†Ø¬Ø§Ø­ âœ…', 'success');
                        } catch (e) {
                            showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                        }
                    });
                },
                
                // Toggle Edit Mode
                toggleEditMode: async () => {
                    try {
                        const newMode = !state.editMode;
                        await db.ref('cms/config/edit_mode').set(newMode);
                        showToast(newMode ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±' : 'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±', 'success');
                    } catch (e) {
                        showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                    }
                },
                
                // Add CMS Section
                addCMSSection: () => {
                    showPrompt('Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯', 'Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ù…Ø«Ø§Ù„: products)', '', (sectionName) => {
                        showPrompt('Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯', 'Ø£ÙˆÙ„ Ù…ÙØªØ§Ø­ ÙÙŠ Ø§Ù„Ù‚Ø³Ù…', '', async (firstKey) => {
                            showPrompt('Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯', 'Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙØªØ§Ø­', '', async (firstValue) => {
                                try {
                                    await db.ref(`cms/content/${sectionName}/${firstKey}`).set(firstValue);
                                    showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                                } catch (e) {
                                    showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                                }
                            });
                        });
                    });
                },
                
                // Edit CMS Section
                editCMSSection: (section) => {
                    showPrompt('Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ§Ø­ Ø¬Ø¯ÙŠØ¯', 'Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ§Ø­', '', (key) => {
                        showPrompt('Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ§Ø­ Ø¬Ø¯ÙŠØ¯', 'Ø§Ù„Ù‚ÙŠÙ…Ø©', '', async (value) => {
                            try {
                                await db.ref(`cms/content/${section}/${key}`).set(value);
                                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                            } catch (e) {
                                showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                            }
                        });
                    });
                },
                
                // Delete CMS Section
                deleteCMSSection: (section) => {
                    showConfirm(
                        'Ø­Ø°Ù Ù‚Ø³Ù…',
                        `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‚Ø³Ù… "${section}" Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ`,
                        async () => {
                            try {
                                await db.ref(`cms/content/${section}`).remove();
                                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                            } catch (e) {
                                showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                            }
                        }
                    );
                },
                
                // Create Page
                createPage: () => {
                    const modal = document.createElement('div');
                    modal.className = 'modal-overlay';
                    modal.innerHTML = `
                        <div class="modal">
                            <div class="modal-header">
                                <h2 class="modal-title">Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                                <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">âœ•</button>
                            </div>
                            <form id="createPageForm">
                                <div class="form-group">
                                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„ØµÙØ­Ø©</label>
                                    <input type="text" name="name" class="form-input" required placeholder="Ù…Ø«Ø§Ù„: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (Emoji)</label>
                                    <input type="text" name="icon" class="form-input" required placeholder="ğŸ“¦" value="ğŸ“¦">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Ø§Ù„ØªØ±ØªÙŠØ¨ (Ø±Ù‚Ù…)</label>
                                    <input type="number" name="order" class="form-input" value="10" required>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-success" style="flex: 1;">
                                        ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙØ­Ø©
                                    </button>
                                    <button type="button" class="btn" style="flex: 1; background: var(--gray-200); color: var(--gray-700);" onclick="this.closest('.modal-overlay').remove()">
                                        âœ• Ø¥Ù„ØºØ§Ø¡
                                    </button>
                                </div>
                            </form>
                        </div>
                    `;
                    
                    modal.querySelector('form').onsubmit = async (e) => {
                        e.preventDefault();
                        const data = new FormData(e.target);
                        const pageId = 'page_' + Date.now();
                        
                        try {
                            await db.ref(`cms/pages/${pageId}`).set({
                                name: data.get('name'),
                                icon: data.get('icon'),
                                order: parseInt(data.get('order')),
                                enabled: true,
                                widgets: []
                            });
                            showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙØ­Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                            modal.remove();
                        } catch (e) {
                            showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                        }
                    };
                    
                    modal.onclick = (e) => {
                        if (e.target === modal) modal.remove();
                    };
                    
                    document.body.appendChild(modal);
                },
                
                // Edit Page
                editPage: (pageId) => {
                    const page = state.customPages[pageId];
                    const modal = document.createElement('div');
                    modal.className = 'modal-overlay';
                    modal.innerHTML = `
                        <div class="modal">
                            <div class="modal-header">
                                <h2 class="modal-title">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</h2>
                                <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">âœ•</button>
                            </div>
                            <form id="editPageForm">
                                <div class="form-group">
                                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„ØµÙØ­Ø©</label>
                                    <input type="text" name="name" class="form-input" value="${page.name}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©</label>
                                    <input type="text" name="icon" class="form-input" value="${page.icon}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Ø§Ù„ØªØ±ØªÙŠØ¨</label>
                                    <input type="number" name="order" class="form-input" value="${page.order}" required>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-success" style="flex: 1;">ğŸ’¾ Ø­ÙØ¸</button>
                                </div>
                            </form>
                        </div>
                    `;
                    
                    modal.querySelector('form').onsubmit = async (e) => {
                        e.preventDefault();
                        const data = new FormData(e.target);
                        try {
                            await db.ref(`cms/pages/${pageId}`).update({
                                name: data.get('name'),
                                icon: data.get('icon'),
                                order: parseInt(data.get('order'))
                            });
                            showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©', 'success');
                            modal.remove();
                        } catch (e) {
                            showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                        }
                    };
                    
                    document.body.appendChild(modal);
                },
                
                // Toggle Page
                togglePage: async (pageId, newState) => {
                    try {
                        await db.ref(`cms/pages/${pageId}/enabled`).set(newState);
                        showToast(newState ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©', 'success');
                    } catch (e) {
                        showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                    }
                },
                
                // Delete Page
                deletePage: (pageId) => {
                    showConfirm(
                        'Ø­Ø°Ù ØµÙØ­Ø©',
                        'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©ØŸ',
                        async () => {
                            try {
                                await db.ref(`cms/pages/${pageId}`).remove();
                                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙØ­Ø©', 'success');
                                app.setView('page_builder');
                            } catch (e) {
                                showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                            }
                        }
                    );
                },
                
                // Add Widget
                addWidget: (pageId) => {
                    const WIDGET_TYPES = {
                        text: { name: 'Ø­Ù‚Ù„ Ù†Øµ', icon: 'ğŸ“' },
                        number: { name: 'Ø­Ù‚Ù„ Ø±Ù‚Ù…', icon: 'ğŸ”¢' },
                        toggle: { name: 'Ø²Ø± ØªØ¨Ø¯ÙŠÙ„', icon: 'ğŸ”˜' },
                        date: { name: 'Ø­Ù‚Ù„ ØªØ§Ø±ÙŠØ®', icon: 'ğŸ“…' }
                    };
                    
                    const modal = document.createElement('div');
                    modal.className = 'modal-overlay';
                    modal.innerHTML = `
                        <div class="modal">
                            <div class="modal-header">
                                <h2 class="modal-title">Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± ØªØ­ÙƒÙ…</h2>
                                <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">âœ•</button>
                            </div>
                            
                            <div style="margin-bottom: 24px;">
                                <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù†ØµØ±</label>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                    ${Object.entries(WIDGET_TYPES).map(([type, info]) => `
                                        <div onclick="window.selectedWidgetType='${type}'; document.querySelectorAll('.widget-type-card').forEach(c => c.style.borderColor='transparent'); event.target.closest('.widget-type-card').style.borderColor='var(--primary)'; document.getElementById('widgetForm').style.display='block';"
                                             class="widget-type-card" 
                                             style="padding: 20px; background: var(--gray-50); border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.2s; border: 2px solid transparent;">
                                            <div style="font-size: 32px; margin-bottom: 8px;">${info.icon}</div>
                                            <div style="font-size: 14px; font-weight: 700;">${info.name}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <form id="widgetForm" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Label)</label>
                                    <input type="text" name="label" class="form-input" required placeholder="Ù…Ø«Ø§Ù„: Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Ù…Ø³Ø§Ø± Firebase</label>
                                    <input type="text" name="firebase_path" class="form-input" required placeholder="Ù…Ø«Ø§Ù„: products/item_1/price">
                                    <p style="font-size: 12px; color: var(--gray-500); margin-top: 4px;">
                                        ğŸ’¡ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù†Ù‡ ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø© Ø¥Ù„ÙŠÙ‡
                                    </p>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Placeholder (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                    <input type="text" name="placeholder" class="form-input" placeholder="Ù†Øµ ØªÙˆØ¶ÙŠØ­ÙŠ">
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-success" style="flex: 1;">
                                        ğŸ’¾ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ±
                                    </button>
                                </div>
                            </form>
                        </div>
                    `;
                    
                    modal.querySelector('form').onsubmit = async (e) => {
                        e.preventDefault();
                        const formData = new FormData(e.target);
                        const widgetData = {
                            id: 'widget_' + Date.now(),
                            type: window.selectedWidgetType,
                            label: formData.get('label'),
                            firebase_path: formData.get('firebase_path'),
                            placeholder: formData.get('placeholder') || ''
                        };
                        
                        try {
                            const page = state.customPages[pageId];
                            const widgets = page.widgets || [];
                            widgets.push(widgetData);
                            
                            await db.ref(`cms/pages/${pageId}/widgets`).set(widgets);
                            showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                            modal.remove();
                        } catch (e) {
                            showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                        }
                    };
                    
                    modal.onclick = (e) => {
                        if (e.target === modal) modal.remove();
                    };
                    
                    document.body.appendChild(modal);
                },
                
                // Delete Widget
                deleteWidget: (pageId, widgetId) => {
                    showConfirm(
                        'Ø­Ø°Ù Ø¹Ù†ØµØ±',
                        'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ',
                        async () => {
                            try {
                                const page = state.customPages[pageId];
                                const widgets = (page.widgets || []).filter(w => w.id !== widgetId);
                                await db.ref(`cms/pages/${pageId}/widgets`).set(widgets);
                                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ±', 'success');
                            } catch (e) {
                                showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                            }
                        }
                    );
                },
                
                // Save Widget Value
                saveWidgetValue: async (widgetId, firebasePath, type) => {
                    const input = document.getElementById(widgetId);
                    if (!input) {
                        showToast('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚Ù„', 'error');
                        return;
                    }
                    
                    let value = input.value;
                    
                    if (type === 'toggle') {
                        value = input.checked;
                    } else if (type === 'number') {
                        value = parseFloat(value);
                        if (isNaN(value)) {
                            showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­', 'error');
                            return;
                        }
                    }
                    
                    try {
                        await db.ref(firebasePath).set(value);
                        showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…', 'success');
                    } catch (e) {
                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸: ' + e.message, 'error');
                    }
                },
                
                // ===== END CMS FUNCTIONS =====
                
                // Admins
                addAdmin: () => {
                    showPrompt('Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯', 'Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù', '', (username) => {
                        if (state.admins[username]) {
                            showToast('Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±Ù Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                            return;
                        }
                        showPrompt('Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', '', async (password) => {
                            try {
                                await db.ref(`admins/${username}`).set({ password });
                                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
                            } catch (e) {
                                showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                            }
                        });
                    });
                },
                
                changeAdminPassword: (username) => {
                    showPrompt('ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', `ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù€ "${username}"`, '', async (newPassword) => {
                        try {
                            await db.ref(`admins/${username}/password`).set(newPassword);
                            showToast('ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        } catch (e) {
                            showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                        }
                    });
                },
                
                deleteAdmin: (username) => {
                    showConfirm(
                        'Ø­Ø°Ù Ù…Ø´Ø±Ù',
                        `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±Ù "${username}"ØŸ`,
                        async () => {
                            try {
                                await db.ref(`admins/${username}`).remove();
                                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
                            } catch (e) {
                                showToast('Ø®Ø·Ø£: ' + e.message, 'error');
                            }
                        }
                    );
                }
            };

            render();
        }
    </script>
</body>
</html>